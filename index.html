<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>HALAL ROULETTE - No Greens No BS</title>

<style>
  :root{
    --bg:#0b1220; --card:#111a2e; --panel:#0e172a;
    --muted:#1b2640; --text:#e7eefc; --border:#23304f;
    --blue:#3b82f6; --blue2:#2563eb;
    --red:#ff4d4d; --blk:#ffffff;
  }

  body{font-family:Arial; padding:28px; background:var(--bg); color:var(--text); overflow-x:hidden;}
  .card{background:var(--card); border-radius:14px; padding:16px; max-width:850px; margin:auto;}
  h1{font-size:28px; margin:6px 0 14px;}

  .row{display:flex; gap:12px; flex-wrap:wrap; margin:10px 0; align-items:center;}
  input{padding:10px; border-radius:10px; background:var(--muted); color:white; border:1px solid var(--border);}

  button{
    padding:10px 14px; border-radius:12px; border:none; cursor:pointer;
    background:linear-gradient(180deg,var(--blue) 0%, var(--blue2) 100%);
    color:white; font-weight:700;
  }
  button.secondary{background:var(--muted); border:1px solid var(--border);}
  button:disabled{opacity:.55; cursor:not-allowed;}

  #result{font-size:60px; margin:20px 0; font-weight:800; text-align:center; position:relative;}
  .red{color:var(--red);}
  .black{color:var(--blk);} /* "blue" choice maps to black result but text stays white */

  .pill{padding:8px 12px; border-radius:999px; background:var(--muted);}

  .stats,.roll-history,.leaderboard{
    margin-top:20px; padding:12px; background:var(--panel); border-radius:12px;
  }

  .leaderboard-entry{display:flex; justify-content:space-between; padding:4px 0;}

  .roll-item{display:inline-block; margin:4px; padding:6px 10px; border-radius:8px; font-weight:bold;}
  .roll-item.red{background:var(--red); color:#111;}
  .roll-item.black{background:#333; color:#fff;}

  /* segmented selector buttons */
  .seg{display:flex; gap:8px; flex-wrap:wrap;}
  .seg button{
    background:var(--muted);
    border:1px solid var(--border);
    font-weight:800;
  }
  .seg button.active{
    background:linear-gradient(180deg,var(--blue) 0%, var(--blue2) 100%);
    border:none;
  }
  .seg button.redbtn.active{background:linear-gradient(180deg,#ff6b6b 0%, #ff3b3b 100%);}
  .seg button.bluebtn.active{background:linear-gradient(180deg,#60a5fa 0%, #2563eb 100%);}

  /* sparkles */
  .sparkle{
    position:fixed;
    width:7px; height:7px;
    background:gold;
    border-radius:50%;
    pointer-events:none;
    transform:translate(-50%,-50%);
    animation:fly 900ms ease-out forwards;
    filter:drop-shadow(0 0 6px rgba(255,215,0,.7));
  }
  @keyframes fly{
    0%{ transform:translate(-50%,-50%) translate(0,0) scale(1); opacity:1; }
    100%{ transform:translate(-50%,-50%) translate(var(--x),var(--y)) scale(.35); opacity:0; }
  }

  /* little "spinning" feel */
  .spinning{
    animation: jitter 420ms linear infinite;
    opacity:.85;
  }
  @keyframes jitter{
    0%{transform:translateY(0)}
    25%{transform:translateY(-2px)}
    50%{transform:translateY(0)}
    75%{transform:translateY(2px)}
    100%{transform:translateY(0)}
  }

  #message{margin-top:6px; min-height:20px;}
</style>
</head>

<body>
  <div class="card">
    <h1>HALAL ROULETTE - No Greens No BS</h1>

    <div class="row">
      <div class="pill">Balance: $<span id="balance">100</span></div>
      <div class="pill">Last payout: $<span id="payout">0</span></div>
      <div class="pill" id="audioStatus" style="display:none;">üîä Audio ready</div>
    </div>

    <div class="row">
      <input id="bet" type="number" placeholder="Bet amount" inputmode="numeric" />
    </div>

    <div class="row">
      <div class="pill">Color:</div>
      <div class="seg" id="colorSeg">
        <button type="button" data-value="red" class="redbtn">Red</button>
        <button type="button" data-value="black" class="bluebtn">Blue</button>
        <button type="button" data-value="" class="active">None</button>
      </div>
    </div>

    <div class="row">
      <div class="pill">Odd/Even:</div>
      <div class="seg" id="paritySeg">
        <button type="button" data-value="odd">Odd</button>
        <button type="button" data-value="even">Even</button>
        <button type="button" data-value="" class="active">None</button>
      </div>
    </div>

    <div class="row">
      <button id="play">Play</button>
      <button id="cashout" class="secondary">Cash Out</button>
      <button id="reset" class="secondary">Reset</button>
    </div>

    <div id="result">‚Äî</div>
    <div id="message"></div>

    <div class="stats">
      <h3>üìä Stats</h3>
      <div>Total Spins: <span id="totalSpins">0</span></div>
      <div>Total Wins: <span id="totalWins">0</span></div>
      <div>Win Rate: <span id="winRate">0%</span></div>
    </div>

    <div class="roll-history">
      <h3>üé≤ Last 10 Rolls</h3>
      <div id="lastRolls"></div>
    </div>

    <div class="leaderboard">
      <h3>üèÜ Leaderboard</h3>
      <div id="leaderboardList"></div>
    </div>
  </div>

<script>
/* -------------------- core roulette logic -------------------- */
const slots = Array.from({length:36},(_,i)=>String(i+1));
const redSet = new Set(["1","3","5","7","9","12","14","16","18","19","21","23","25","27","30","32","34","36"]);

const getColor = (slot) => redSet.has(slot) ? "red" : "black";
const getParity = (slot) => (Number(slot) % 2 === 0) ? "even" : "odd";
const pickRandomSlot = () => slots[(Math.random() * slots.length) | 0];

let balance = 100, totalSpins = 0, totalWins = 0;
let lastTen = [];

const $ = (id) => document.getElementById(id);
const balanceEl = $("balance");
const payoutEl  = $("payout");
const resultEl  = $("result");
const msgEl     = $("message");
const playBtn   = $("play");

/* -------------------- segmented buttons (no dropdowns) -------------------- */
function makeSegment(segEl, onChange){
  segEl.addEventListener("click", (e) => {
    const btn = e.target.closest("button[data-value]");
    if(!btn) return;
    [...segEl.querySelectorAll("button")].forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    onChange(btn.dataset.value);
  });
  // return getter
  return () => segEl.querySelector("button.active")?.dataset.value ?? "";
}

const getGuessColor  = makeSegment($("colorSeg"),  () => {});
const getGuessParity = makeSegment($("paritySeg"), () => {});

/* -------------------- UI updates -------------------- */
function updateStats(){
  $("totalSpins").textContent = totalSpins;
  $("totalWins").textContent  = totalWins;
  const rate = totalSpins ? ((totalWins/totalSpins)*100).toFixed(1) : "0.0";
  $("winRate").textContent = rate + "%";
}

function updateRollHistory(){
  const container = $("lastRolls");
  container.innerHTML = "";
  lastTen.slice(-10).reverse().forEach(r=>{
    const div = document.createElement("div");
    div.className = "roll-item " + r.color;
    div.textContent = r.number;
    container.appendChild(div);
  });
}

/* -------------------- sparkles FROM the number -------------------- */
function sparkleFromResult(){
  const rect = resultEl.getBoundingClientRect();
  const originX = rect.left + rect.width/2;
  const originY = rect.top  + rect.height/2;

  const count = 36;
  for(let i=0;i<count;i++){
    const s = document.createElement("div");
    s.className = "sparkle";
    s.style.left = originX + "px";
    s.style.top  = originY + "px";

    const angle = Math.random() * Math.PI * 2;
    const dist  = 80 + Math.random() * 140;
    const x = Math.cos(angle) * dist;
    const y = Math.sin(angle) * dist;

    s.style.setProperty("--x", x + "px");
    s.style.setProperty("--y", y + "px");

    document.body.appendChild(s);
    s.addEventListener("animationend", () => s.remove(), {once:true});
  }
}

/* -------------------- mobile audio reliability (Chrome iOS/Android) -------------------- */
/*
  Approach:
  - Audio must be started after a user gesture on mobile. We ‚Äúunlock‚Äù on first Play tap.
  - Use a small pool of Audio objects per sound (avoids "already playing" issues).
  - Preload + play a silent tick once to satisfy gesture requirement.
*/
const SOUND_FILES = {
  spin:  "spin.mp3",
  win:   "win.mp3",
  lose:  "lose.mp3"
};

const audio = {
  unlocked: false,
  pools: {},
  poolSize: 3
};

function buildPool(src){
  const pool = [];
  for(let i=0;i<audio.poolSize;i++){
    const a = new Audio(src);
    a.preload = "auto";
    a.playsInline = true;   // iOS hint
    pool.push(a);
  }
  return { pool, index: 0 };
}

function initAudio(){
  if(audio.unlocked) return;
  // Create pools
  for(const k in SOUND_FILES){
    audio.pools[k] = buildPool(SOUND_FILES[k]);
  }
  // Attempt to unlock: play/pause quickly (must be inside gesture)
  try {
    const a = audio.pools.spin.pool[0];
    a.muted = true;
    a.currentTime = 0;
    a.play().then(()=>{
      a.pause();
      a.muted = false;
      audio.unlocked = true;
      const st = $("audioStatus");
      st.style.display = "inline-block";
      setTimeout(()=>st.style.display="none", 1200);
    }).catch(()=>{ /* will retry next gesture */ });
  } catch(_) {}
}

function playSound(name){
  if(!audio.unlocked) return; // will become reliable after unlock
  const entry = audio.pools[name];
  if(!entry) return;

  const a = entry.pool[entry.index];
  entry.index = (entry.index + 1) % entry.pool.length;

  try{
    a.currentTime = 0;
    const p = a.play();
    // If blocked (rare after unlock), ignore gracefully
    if(p && typeof p.catch === "function") p.catch(()=>{});
  } catch(_) {}
}

/* -------------------- spin flow (with quick "reveal after spin") -------------------- */
let spinning = false;

function spin(){
  if(spinning) return;

  initAudio(); // IMPORTANT: called within button click gesture
  const bet = Number($("bet").value);
  const guessColor  = getGuessColor();
  const guessParity = getGuessParity();

  if(!bet || bet<=0 || bet>balance){ msgEl.textContent="Invalid bet"; return; }
  if(!guessColor && !guessParity){ msgEl.textContent="Pick a guess"; return; }

  spinning = true;
  playBtn.disabled = true;

  balance -= bet;
  totalSpins++;

  // fake spin animation
  resultEl.classList.add("spinning");
  resultEl.className = "spinning"; // clear color classes while spinning
  msgEl.textContent = "Spinning...";
  payoutEl.textContent = "0";
  balanceEl.textContent = balance;

  playSound("spin");

  const revealDelay = 850;
  const slot = pickRandomSlot();
  const color = getColor(slot);
  const parity = getParity(slot);

  setTimeout(()=>{
    // reveal
    resultEl.classList.remove("spinning");
    resultEl.textContent = slot;
    resultEl.className = color;

    let payout = 0;
    if(guessColor && guessParity){
      if(guessColor === color && guessParity === parity) payout = bet * 4;
    } else {
      if((guessColor && guessColor === color) || (guessParity && guessParity === parity)) payout = bet * 2;
    }

    if(payout > 0){
      balance += payout;
      totalWins++;
      payoutEl.textContent = payout;
      balanceEl.textContent = balance;
      msgEl.textContent = "You won $" + payout;
      sparkleFromResult();
      playSound("win");
    } else {
      payoutEl.textContent = 0;
      balanceEl.textContent = balance;
      msgEl.textContent = "You lost $" + bet;
      playSound("lose");
    }

    lastTen.push({number:slot, color});
    if(lastTen.length > 10) lastTen.shift();

    updateStats();
    updateRollHistory();

    spinning = false;
    playBtn.disabled = false;
  }, revealDelay);
}

/* -------------------- leaderboard -------------------- */
const LB_KEY = "rouletteLeaderboard";
const getLeaderboard = () => JSON.parse(localStorage.getItem(LB_KEY) || "[]");
const saveLeaderboard = (d) => localStorage.setItem(LB_KEY, JSON.stringify(d));

function renderLeaderboard(){
  const list = $("leaderboardList");
  list.innerHTML = "";
  getLeaderboard()
    .sort((a,b)=>b.score-a.score)
    .forEach(e=>{
      const div = document.createElement("div");
      div.className = "leaderboard-entry";
      div.innerHTML = `<span>${e.name}</span><span>$${e.score}</span>`;
      list.appendChild(div);
    });
}

function cashOut(){
  if(balance <= 0){ msgEl.textContent="No money to cash out"; return; }
  const name = prompt("Enter name for leaderboard:");
  if(!name) return;
  const data = getLeaderboard();
  data.push({name, score: balance});
  saveLeaderboard(data);
  renderLeaderboard();
  msgEl.textContent = name + " cashed out with $" + balance;
  balance = 0;
  balanceEl.textContent = balance;
}

function reset(){
  balance = 100; totalSpins = 0; totalWins = 0; lastTen = [];
  updateStats(); updateRollHistory();
  balanceEl.textContent = balance;
  payoutEl.textContent = 0;
  resultEl.textContent = "‚Äî";
  resultEl.className = "";
  msgEl.textContent = "Game reset";
}

/* -------------------- events -------------------- */
$("play").addEventListener("click", spin);
$("cashout").addEventListener("click", cashOut);
$("reset").addEventListener("click", reset);

// Also unlock audio if user taps anywhere on the card first (helps mobile)
document.querySelector(".card").addEventListener("touchstart", initAudio, {passive:true});
document.querySelector(".card").addEventListener("pointerdown", initAudio);

updateStats();
updateRollHistory();
renderLeaderboard();
</script>
</body>
</html>
